## Koa路由?

- https://www.npmjs.com/package/koa-router

- 使用步骤

  1. 下载,引入,实例化
  2. 处理 get 请求和 post 请求
  3. 注册路由中间件

  ```shell
  npm i koa-router
  ```

  

```js
// 1.2 导入Koa
const Koa = require('koa');
const Router = require('koa-router'); // 导入处理路由的模块
const router = new Router(); // 创建路由对象

// 1.3 创建服务端实例对象
const app = new Koa();
// 2. 处理请求
// 处理 get 请求 返回字符串
router.get('/api/goods/list', (ctx, next)=>{
  // ctx.body === res.writeHeader + res.end
  ctx.body = 'get /api/goods/list'; 
});
// 处理 get 请求 返回 json 数据
router.get('/api/user/login', (ctx, next)=>{
  ctx.body = {
    method: 'get',
    name: 'neal',
    age: 66
  }
});

// 处理 post 请求返回字符串
router.post('/api/goods/detail', (ctx, next)=>{
  ctx.body = 'post /api/goods/detail';
});
// 处理 post 请求返回对象
router.post('/api/user/register', (ctx, next)=>{
  ctx.body = {
    method: 'post',
    name: 'neal',
    age: 33
  }
});
// 3. 注册路由中间件
app.use(router.routes()) // 注册路由功能
  .use(router.allowedMethods()); // 自动设置响应头

// 3.指定监听的端口
app.listen(3000);
```



## 自动路由

- 使用 `require-directory` 模块

- 安装

  ```shell
  npm i require-directory
  ```

- 使用

```js
// 1.导入Koa
const Koa = require('koa');
const Router = require('koa-router');
const requireDirectory = require('require-directory')
// 2.创建服务端实例对象
const app = new Koa();

/*
通过 requireDirectory 自动加载指定目录下文件为路由文件
参数 1:固定写法
参数 2:指定目录的路径
参数 3:配置项 visit配置回掉函数
*/ 
requireDirectory(module, './api',{
  visit:whenLoadModule
})
function whenLoadModule(obj) {
  if (obj instanceof Router) {
    app.use(obj.routes())
  }
}


// 3.指定监听的端口
app.listen(3000);
```



路由文件

> v1 是 api 版本,这样以后 api 扩展版本更容易

- api

  - v1

    - home

      - home.js

      ```js
      const Router = require('koa-router')
      const router = new Router()
      
      router.get('/v1/home/home', async (ctx, next) => {
          ctx.body = {
              key: 'book'
          }
      })
      导出
      module.exports = router
      ```

    
